{"version":3,"sources":["../../../src/context/providers/ThreadRuntimeProvider.tsx"],"sourcesContent":["\"use client\";\n\nimport type { FC, PropsWithChildren } from \"react\";\nimport { useEffect, useState } from \"react\";\nimport type { ThreadContextValue } from \"../react/ThreadContext\";\nimport { ThreadContext } from \"../react/ThreadContext\";\nimport { writableStore } from \"../ReadonlyStore\";\nimport { ThreadRuntime } from \"../../api/ThreadRuntime\";\nimport { create } from \"zustand\";\nimport { ThreadListItemRuntime } from \"../../api/ThreadListItemRuntime\";\nimport { ThreadListItemRuntimeProvider } from \"./ThreadListItemRuntimeProvider\";\nimport { ensureBinding } from \"../react/utils/ensureBinding\";\nimport { ThreadViewportProvider } from \"./ThreadViewportProvider\";\n\ntype ThreadProviderProps = {\n  listItemRuntime: ThreadListItemRuntime;\n  runtime: ThreadRuntime;\n};\n\nconst useThreadRuntimeStore = (runtime: ThreadRuntime) => {\n  const [store] = useState(() => create(() => runtime));\n\n  useEffect(() => {\n    ensureBinding(runtime);\n    ensureBinding(runtime.composer);\n\n    writableStore(store).setState(runtime, true);\n  }, [runtime, store]);\n\n  return store;\n};\n\nexport const ThreadRuntimeProvider: FC<\n  PropsWithChildren<ThreadProviderProps>\n> = ({ children, listItemRuntime: threadListItemRuntime, runtime }) => {\n  const useThreadRuntime = useThreadRuntimeStore(runtime);\n\n  const [context] = useState<ThreadContextValue>(() => {\n    return {\n      useThreadRuntime,\n    };\n  });\n\n  return (\n    <ThreadListItemRuntimeProvider runtime={threadListItemRuntime}>\n      <ThreadContext.Provider value={context}>\n        {/* TODO temporarily allow accessing viewport state from outside the viewport */}\n        {/* TODO figure out if this behavior should be deprecated, since it is quite hacky */}\n        <ThreadViewportProvider>{children}</ThreadViewportProvider>\n      </ThreadContext.Provider>\n    </ThreadListItemRuntimeProvider>\n  );\n};\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA,mBAAoC;AAEpC,2BAA8B;AAC9B,2BAA8B;AAE9B,qBAAuB;AAEvB,2CAA8C;AAC9C,2BAA8B;AAC9B,oCAAuC;AAoC/B;AA7BR,IAAM,wBAAwB,CAAC,YAA2B;AACxD,QAAM,CAAC,KAAK,QAAI,uBAAS,UAAM,uBAAO,MAAM,OAAO,CAAC;AAEpD,8BAAU,MAAM;AACd,4CAAc,OAAO;AACrB,4CAAc,QAAQ,QAAQ;AAE9B,4CAAc,KAAK,EAAE,SAAS,SAAS,IAAI;AAAA,EAC7C,GAAG,CAAC,SAAS,KAAK,CAAC;AAEnB,SAAO;AACT;AAEO,IAAM,wBAET,CAAC,EAAE,UAAU,iBAAiB,uBAAuB,QAAQ,MAAM;AACrE,QAAM,mBAAmB,sBAAsB,OAAO;AAEtD,QAAM,CAAC,OAAO,QAAI,uBAA6B,MAAM;AACnD,WAAO;AAAA,MACL;AAAA,IACF;AAAA,EACF,CAAC;AAED,SACE,4CAAC,sEAA8B,SAAS,uBACtC,sDAAC,mCAAc,UAAd,EAAuB,OAAO,SAG7B,sDAAC,wDAAwB,UAAS,GACpC,GACF;AAEJ;","names":[]}